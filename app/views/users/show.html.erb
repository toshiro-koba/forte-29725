<%= render "shared/second-header"%>
<%= "#{@user.nickname}の詳細ページ" %>

<% if @user == current_user %>
  <%= link_to "ユーザー情報を編集する", edit_user_path(current_user) %>
  <% if @user.profile == nil %>
    <p><%= link_to "プロフィールを新しく設定する", new_user_profile_path(current_user) %></p>
  <% else %>
    <p><%= link_to "プロフィールを編集する", edit_user_profile_path(current_user) %></p>
  <% end %>
  <p><%= link_to "好きなゲームをお気に入り登録する", bookmark_user_path(current_user) %></p>
  <div class="gift-action">
    <div class="gift-action-title">
      <p>自分がしたギフト</p>
    </div>
    <% @giftings.each do |gift| %>
      <div class="gift">
        <p><%= "#{gift.user.nickname}に#{gift.price}円をギフトした！" %></p>
      </div>
    <% end %>
  </div>
  <div class="gift-action">
    <div class="gift-action-title">
      <p>自分に送られたギフト</p>
    </div>
    <% @receivings.each do |gift| %> 
      <div class="gift">
        <p><%= "#{gift.giver.nickname}から#{gift.price}円をギフトされた！感謝します！" %></p>
      </div>
    <% end %> 
  </div> 
<% elsif user_signed_in? %>
  <%= link_to 'ギフトする！', user_gifts_path(@user) %>
  <%= render 'relationships/follow_button', user: @user %>
<% else %>
  <%= link_to 'ギフトする！', new_user_session_path %>
<% end %>
<p>--ブックマークしたゲーム--</p>
<% Bookmark.where(user_id: @user.id).each do |game| %>
  <p><%= game.game_tag.game_title %></p>
<% end %>
<p>--フォローした人--</p>
<% @user.followings.each do |following| %>
  <p><%= following.nickname %></p>
<% end %>
<p>--フォローしてくれてる人--</p>
<% @user.followers.each do |follower| %>
  <p><%= follower.nickname %></p>
<% end %>

<% unless @user.profile == nil %>

  <p><%= "↓#{@user.nickname}のプロフィール！↓" %></p>
  <% if @user.profile.image? %>
    <p><%= image_tag(@user.profile.image.thumb100.url) %></p>
  <% else %>
    <%= image_tag "default.jpg", :size => '50x50' %>
  <% end %>
  <% if @user.profile.link_to_sns? %>
    <p><%= link_to "SNS", @user.profile.link_to_sns %></p>
  <% else %>
    <p><%= "SNSは設定されていません" %></p>
  <% end %>
  <% if @user.profile.link_to_webcast? %>
    <p><%= link_to "配信サイト", @user.profile.link_to_webcast %></p>
  <% else %>
    <p><%= "配信サイトは設定されていません" %></p>
  <% end %>
  <% if @user.profile.self_introduction? %>
    <p><%= safe_join(@user.profile.self_introduction.split("\n"),tag(:br))%></p>
  <% else %>
    <p><%= "自己紹介分は設定されていません" %></p>
  <% end %>
<% end %>

<% if user_signed_in? && current_user != @user %>
  <div class='chat-room-form'>
    <h1>新しく質問する</h1>
    <%= form_with(url: rooms_path, model: @room, local: true, method: :post, id: 'form') do |f| %>
    <div id="error-lists">
      <div id="error">
      </div>
    </div>
      <div class='chat-room-form__field'>
        <div class='chat-room-form__field--left'>
          <%= f.label :質問タイトル, class: 'chat-room-form__label'%>
        </div>
        <div class='chat-room-form__field--right'>
          <%= f.text_field :question_title, class: 'chat__room_name chat-room-form__input', placeholder: '質問タイトルを入力してね！', id: "question_title"%>
        </div>
      </div>
      <div class='chat-room-form__field'>
      </div>
      <div class='chat-room-form__field'>
        <div class='chat-room-form__field--left'>
          <label class='chat-room-form__label' for='chat_room_回答して欲しい人'>回答して欲しい人</label>
        </div>
        <div class='chat-room-form__field--right'>
          <select name="room[user_ids][]", id="user">
            <option value="">回答して欲しいユーザーを選んでね！</option>
            <% User.all.where.not(id: current_user.id).each do |user| %>
              <option value=<%=user.id%>><%= user.nickname %></option>
            <% end %>
          </select>
          <input name="room[user_ids][]" type="hidden" value=<%=current_user.id%>>
        </div>
      </div>
      <div class='chat-room-form__field'>
        <div class='chat-room-form__field--left'>
          <label class='chat-room-form__label' for='chat_room_ゲームタイトル'>ゲームタイトル</label>
        </div>
        <div class='chat-room-form__field--right'>
          <select name="room[game_tag_ids][]", id="game-tag">
            <option value="">ゲームタイトルを選んでね！</option>
            <% GameTag.all.each do |tag| %>
              <option value=<%=tag.id%>><%= tag.game_title %></option>
            <% end %>
          </select>
        </div>
      </div>
      <div class='chat-room-form__field'>
        <div class='chat-room-form__field--left'>
          <%= f.label :質問本文, class: 'chat-room-form__label'%>
        </div>
        <div class='chat-room-form__field--right'>
          <%= f.text_area :content, class: 'chat__room_name chat-room-form__input', placeholder: '質問本文を入力してね！' , id: "content"%>
        </div>
      </div>
      <div class='chat-room-form__field'>
        <div class='chat-room-form__field--left'></div>
        <div class='chat-room-form__field--right'>
          <%= f.submit value="Create Question", class: 'chat-room-form__action-btn', id: "submit" %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
<div id="list">
            </div>